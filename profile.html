<!DOCTYPE html>
<html>
<head>
<title>Student Profile</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="style.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    background: #f5f7fb;
}

.profile-card {
    max-width: 700px;
    margin: auto;
    border-radius: 15px;
}
</style>
</head>

<body>

<script src="script.js"></script>

<script>
window.onload = function () {
    checkAccess("student");
    loadProfile();
};
</script>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark">
<div class="container-fluid">
<span class="navbar-brand">Student Profile</span>

<div>
<a href="dashboard.html" class="btn btn-warning me-2">
Dashboard
</a>

<button onclick="logout()" class="btn btn-danger">
Logout
</button>
</div>
</div>
</nav>

<!-- Profile Section -->
<div class="container mt-5 mb-5">

<div class="card shadow p-4 profile-card">

<h3 class="text-center mb-4">Student Details</h3>

<div class="mb-2">
<strong>Name:</strong>
<span id="name"></span>
</div>

<div class="mb-3">
<strong>Attendance:</strong>
<span id="attendance"></span>
</div>

<h5 class="mt-3">Marks</h5>

<ul id="marks" class="list-group mt-2"></ul>

</div>

</div>

<script>
async function loadProfile() {
    const user = JSON.parse(localStorage.getItem("user"));

    if (!user || !user.studentid) {
        alert("Student ID missing");
        return;
    }

    try {
        const res = await fetch(
            `${API_BASE}/student/${user.studentid}`
        );

        const data = await res.json();

        if (!data) return;

        document.getElementById("name").innerText =
            data.name || "-";

        document.getElementById("attendance").innerText =
            (data.attendance || "0") + "%";

        const marksList = document.getElementById("marks");
        marksList.innerHTML = "";

        const marks = data.marks || {};

        if (Object.keys(marks).length === 0) {
            marksList.innerHTML =
                `<li class="list-group-item text-muted">
                    No marks available yet
                 </li>`;
            return;
        }

        for (let subject in marks) {
            const li = document.createElement("li");
            li.className = "list-group-item";
            li.innerText = subject + " : " + marks[subject];
            marksList.appendChild(li);
        }

    } catch (err) {
        console.log("Profile load failed:", err);
    }
}
</script>

</body>
</html>
