<!DOCTYPE html>
<html>
<head>
<title>Student Profile</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="style.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { background:#f5f7fb; }

.profile-card {
    max-width:900px;
    margin:auto;
    border-radius:15px;
}
.label { font-weight:bold; }
</style>
</head>

<body>

<script src="script.js"></script>

<script>
window.onload = function () {
    checkAccess("student");
    loadProfile();
};
</script>

<nav class="navbar navbar-dark bg-dark">
<div class="container-fluid">
<span class="navbar-brand">Student Profile</span>

<div>
<a href="dashboard.html" class="btn btn-warning me-2">
Dashboard
</a>

<button onclick="logout()" class="btn btn-danger">
Logout
</button>
</div>
</div>
</nav>

<div class="container mt-5 mb-5">

<div class="card shadow p-4 profile-card">

<h3 class="text-center mb-4">Student Details</h3>

<div class="row">

<div class="col-md-6 mb-2">
<span class="label">Username:</span>
<span id="username"></span>
</div>

<div class="col-md-6 mb-2">
<span class="label">Name:</span>
<span id="name"></span>
</div>

<div class="col-md-6 mb-2">
<span class="label">Phone:</span>
<span id="phone"></span>
</div>

<div class="col-md-6 mb-2">
<span class="label">Email:</span>
<span id="email"></span>
</div>

<div class="col-md-6 mb-2">
<span class="label">Parent Name:</span>
<span id="parentname"></span>
</div>

<div class="col-md-6 mb-2">
<span class="label">Parent Phone:</span>
<span id="parentphone"></span>
</div>

<div class="col-md-6 mb-2">
<span class="label">Year:</span>
<span id="year"></span>
</div>

<div class="col-md-6 mb-2">
<span class="label">Aadhaar:</span>
<span id="aadhaar"></span>
</div>

<div class="col-md-12 mb-3">
<span class="label">Address:</span>
<span id="address"></span>
</div>

<div class="col-md-6 mb-3">
<span class="label">Attendance:</span>
<span id="attendance"></span>
</div>

</div>

<hr>

<h5>Marks</h5>
<ul id="marks" class="list-group mt-2"></ul>

</div>
</div>

<script>
async function loadProfile() {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) return;

    const sid = user.studentid || user.studentId || user.id;

    const res = await fetch(`${API_BASE}/student/${sid}`);
    const data = await res.json();
    if (!data) return;

    document.getElementById("username").innerText = data.username || "-";
    document.getElementById("name").innerText = data.name || "-";
    document.getElementById("phone").innerText = data.phone || "-";
    document.getElementById("email").innerText = data.email || "-";
    document.getElementById("parentname").innerText = data.parentname || "-";
    document.getElementById("parentphone").innerText = data.parentphone || "-";
    document.getElementById("year").innerText = data.year || "-";
    document.getElementById("aadhaar").innerText = data.aadhaar || "-";
    document.getElementById("address").innerText = data.address || "-";

    document.getElementById("attendance").innerText =
        data.attendance || "-";

    const marksList = document.getElementById("marks");
    marksList.innerHTML = "";

    const marks = data.marks || {};

    if (Object.keys(marks).length === 0) {
        marksList.innerHTML =
          `<li class="list-group-item text-muted">No marks available</li>`;
        return;
    }

    for (let subject in marks) {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.innerText = subject + " : " + marks[subject];
        marksList.appendChild(li);
    }
}
</script>

</body>
</html>
