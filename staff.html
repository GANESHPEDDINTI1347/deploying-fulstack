<!DOCTYPE html>
<html>
<head>
    <title>Staff Panel</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f5f7fb;
        }

        .staff-card {
            max-width: 700px;
            margin: auto;
            border-radius: 15px;
        }
    </style>
</head>

<body>

<!-- Common script -->
<script src="script.js"></script>

<!-- Role Protection -->
<script>
window.onload = function () {
    checkAccess("staff");
};
</script>

<!-- Navbar -->
<nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
        <span class="navbar-brand">Staff Panel</span>
        <button onclick="logout()" class="btn btn-danger">
            Logout
        </button>
    </div>
</nav>

<!-- Staff Panel -->
<div class="container mt-5 mb-5">

    <div class="card shadow p-4 staff-card">

        <h3 class="mb-3 text-center">Update Student Details</h3>

        <input id="username" class="form-control mb-2"
               placeholder="Student Username">

        <input id="attendance" class="form-control mb-2"
               placeholder="Attendance %">

        <input id="subject" class="form-control mb-2"
               placeholder="Subject">

        <input id="marks" class="form-control mb-3"
               placeholder="Marks">

        <button onclick="updateStudent()" class="btn btn-primary w-100">
            Update Student
        </button>

        <p id="msg" class="mt-3 text-success text-center"></p>

        <hr class="my-4">

        <!-- CSV Upload -->
        <h4>Upload Students CSV</h4>

        <input type="file" id="csvFile"
               class="form-control mb-2">

        <button onclick="uploadCSV()"
                class="btn btn-success w-100">
            Upload Students
        </button>

        <p id="uploadMsg" class="mt-2 text-center"></p>

    </div>

</div>

<script>
async function updateStudent() {
    const username = document.getElementById("username").value.trim();
    const attendance = document.getElementById("attendance").value.trim();
    const subject = document.getElementById("subject").value.trim();
    const marks = document.getElementById("marks").value.trim();

    if (!username) {
        alert("Enter student username");
        return;
    }

    try {
        const res = await fetch(
            "https://backend-deployment-2-16fx.onrender.com/updateByUsername",
            {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    username,
                    attendance,
                    subject,
                    marks
                })
            }
        );

        const data = await res.json();
        document.getElementById("msg").innerText = data.message;

    } catch {
        alert("Update failed");
    }
}
</script>

</body>
</html>
